"use strict";let unsaved=!1;const $activityTable=$("#activityTable"),rowTemplate=(t,e={})=>{const a=$("<tr>"),i=$(`<input type="image" class="form-control-sm grade-btn" src="img/edit.svg" id="grade${t}" aria-label="Edit grade" />`).data("grade",e.grade||0),n=$(`<input type="image" class="form-control-sm timing-btn" src="img/edit.svg" id="timing${t}" aria-label="Edit timing" />`).data("timing",e.timing||0),d=$(`<input type="image" class="form-control-sm tags-btn" src="img/edit.svg" id="tags${t}" aria-label="Edit tags" />`).data("tags",e.tags||[]);return a.append([`<td><input type="text" class="form-control activity-name" id="name${t}" aria-label="Name ${t}" value="${e.name||""}" /></td>`,`<td><textarea type="text" class="form-control activity-description" id="description${t}" aria-label="Description ${t}" rows="1">${e.description||""}</textarea></td>`,$("<td>").append(i),$("<td>").append(n),$("<td>").append(d),'<td>\n            <div class="btn-group" role="group">\n                <button type="button" class="btn btn-outline-primary activity-add">+</button>\n                <button type="button" class="btn btn-outline-primary activity-remove" disabled>-</button>\n            </div>\n        </td>']),a},removeEmptyRows=()=>$activityTable.find("tr").filter(((t,e)=>!($(e).find(".activity-name").val().trim()||$(e).find(".activity-description").val().trim()||$(e).find(".grade-btn").data("grade")||$(e).find(".timing-btn").data("timing")||$(e).find(".tags-btn").data("tags")?.length))).remove(),$file=$("#activityFile"),reader=new FileReader;reader.onload=()=>{const t=JSON.parse(reader.result);Array.isArray(t)&&t.length&&(removeEmptyRows(),t.forEach((t=>{$activityTable.append(rowTemplate(++rowCount,t))})),$(".activity-remove").prop("disabled",!1))},$file.on("change",(()=>{const t=$file.prop("files")[0];reader.readAsText(t)}));const $activityList=$("#activityList"),$activityListBtn=$("#activityListBtn");$activityListBtn.on("click",(()=>{const t=$activityList.val().split(/\r?\n/).map((t=>t.trim())).filter(Boolean);if(!t.length)return;removeEmptyRows();const e=$activityTable.find(".activity-name").map(((t,e)=>$(e).val().trim())).get();t.forEach((t=>{e.includes(t)||$activityTable.append(rowTemplate(++rowCount,{name:t}))}))}));let rowCount=1;$(document).on("click",".activity-add",(()=>{$activityTable.append(rowTemplate(++rowCount)),$(".activity-remove").prop("disabled",!1)})),$(document).on("click",".activity-remove",(t=>{$(t.target).closest("tr").remove(),$(".activity-remove").prop("disabled",1==--rowCount)}));const GRADES=["MS","G9","G10","G11","G12"],TIMINGS=["Mon L1","Mon L2","Mon Aft","Tue L1","Tue L2","Tue Aft","Wed L1","Wed L2","Wed Aft","Thu L1","Thu L2","Thu Aft","Fri L1","Fri L2","Fri Aft"],TAGS=["arts","stem","econs","literature","history","chinese","publications","entertainment","leadership","others","visual-art","music","photography","other-arts","science","coding","engineering","math"],editModal=new bootstrap.Modal("#editModal"),$editModal=$("#editModal"),$editProperty=$("#editProperty"),$editName=$("#editName"),$editContent=$("#editContent"),$editSave=$("#editSave");$(document).on("click",".grade-btn, .timing-btn, .tags-btn",(t=>{const e=$(t.target);if($editModal.data("caller",e),$editContent.empty(),e.hasClass("grade-btn")){$editModal.data("state","grade"),$editProperty.text("grade");const t=e.data("grade")||0;$editContent.append(GRADES.map(((e,a)=>`<div class="form-check"><input class="form-check-input" name="grade" type="checkbox" value="${1<<a}" id="grade-${a}" ${t>>a&1?"checked":""}><label class="form-check-label" for="grade-${a}">${e}</label></div>`)))}else if(e.hasClass("timing-btn")){$editModal.data("state","timing"),$editProperty.text("timing");const t=e.data("timing")||0;$editContent.append(TIMINGS.map(((e,a)=>`<div class="form-check"><input class="form-check-input" name="timing" type="checkbox" value="${1<<a}" id="timing-${a}" ${t>>a&1?"checked":""}><label class="form-check-label" for="timing-${a}">${e}</label></div>`)))}else if(e.hasClass("tags-btn")){$editModal.data("state","tags"),$editProperty.text("tags");const t=e.data("tags")||[];$editContent.append(TAGS.map(((e,a)=>`<div class="form-check"><input class="form-check-input" name="timing" type="checkbox" value="${e}" id="tag-${a}" ${t.includes(e)?"checked":""}><label class="form-check-label" for="tag-${a}">${e}</label></div>`)))}$editName.text(e.closest("tr").find(".activity-name").val()),editModal.show()})),$editSave.on("click",(()=>{const{state:t,caller:e}=$editModal.data();switch(t){case"grade":case"timing":e.data(t,$editContent.find("input:checked").map(((t,e)=>parseInt($(e).val()))).get().reduce(((t,e)=>t+e),0));break;case"tags":e.data(t,$editContent.find("input:checked").map(((t,e)=>$(e).val())).get());break}unsaved=!0})),$("#download").on("click",(()=>{const t=[];$activityTable.find("tr").each(((e,a)=>{const i=$(a),n=i.find(".activity-name").val().trim(),d=i.find(".activity-description").val().trim(),r=i.find(".grade-btn").data("grade")||0,o=i.find(".timing-btn").data("timing")||0,c=i.find(".tags-btn").data("tags")||[];(n||d||r||o||c.length)&&t.push({name:n,description:d,grade:r,timing:o,tags:c})}));const e=JSON.stringify(t),a=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(a),n=document.createElement("a");n.href=i,n.download="activities.json",n.click(),URL.revokeObjectURL(i)})),window.onbeforeunload=()=>{if([].concat($activityTable.find(".activity-name").map(((t,e)=>$(e).val().trim())),$activityTable.find(".activity-description").map(((t,e)=>$(e).val().trim())),$activityTable.find(".grade-btn").map(((t,e)=>$(e).data("grade"))),$activityTable.find(".timing-btn").map(((t,e)=>$(e).data("timing"))),$activityTable.find(".tags-btn").map(((t,e)=>$(e).data("tags"))).length).filter(Boolean).length)return!0};